<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocAuth OCR - V√©rification intelligente</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }

        /* Header */
        header {
            background: white;
            padding: 1rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: #e67e22;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(230, 126, 34, 0.2);
        }

        .logo-shield {
            width: 28px;
            height: 28px;
            border: 3px solid white;
            border-radius: 6px;
            position: relative;
        }

        .logo-shield::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
        }

        .logo-text h1 span {
            color: #f97316;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: background 0.2s ease;
        }

        .icon-btn:hover {
            background: #f1f5f9;
        }

        .notification-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: #f97316;
            border-radius: 50%;
            border: 2px solid white;
        }

        /* Container */
        .container { max-width: 1400px; margin: 0 auto; padding: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .section { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #333; }

        /* Document Type Selector */
        .document-type { border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: all 0.3s ease; }
        .document-type:hover { border-color: #e67e22; background: #fff8f0; }
        .doc-icon { width: 40px; height: 40px; background: #fff3e6; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #e67e22; font-size: 20px; }
        .doc-type-text { display: flex; flex-direction: column; margin-left: 12px; }
        .doc-label { font-size: 11px; color: #999; text-transform: uppercase; }
        .doc-name { font-size: 16px; font-weight: 500; }
        .doc-option { padding: 12px 15px; cursor: pointer; transition: background 0.2s; }
        .doc-option:hover { background-color: #fff8f0; color: #e67e22; }

        /* Upload Area */
        .upload-area { border: 2px dashed #d0d0d0; border-radius: 12px; padding: 60px 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .upload-area.dragover { border-color: #e67e22; background: #fff8f0; transform: scale(1.01); }
        .upload-icon { width: 80px; height: 80px; background: #f5f5f5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 40px; color: #999; }
        .upload-link { color: #e67e22; text-decoration: none; font-weight: 500; }
        .file-input { display: none; }

        .analyze-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #e67e22, #d35400); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }
        .analyze-btn:disabled { background: #ccc; cursor: not-allowed; }

        .file-preview { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none; align-items: center; gap: 12px; }
        .file-preview.show { display: flex; }

        /* Results */
        .result-placeholder { text-align: center; padding: 80px 20px; }
        .result-content { display: none; }
        .result-content.show { display: block; }

        /* Status Card */
        .status-card { background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border-radius: 16px; padding: 24px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; border: 1px solid #fecaca; }
        .status-card.success { background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-color: #bbf7d0; }
        .status-header { display: flex; align-items: center; gap: 16px; }
        .status-icon { width: 56px; height: 56px; border-radius: 12px; background: #dc2626; display: flex; align-items: center; justify-content: center; font-size: 28px; color: white; flex-shrink: 0; }
        .status-icon.success { background: #16a34a; }
        .status-info { flex: 1; }
        .status-title { font-size: 20px; font-weight: 600; color: #1e293b; margin: 0 0 4px 0; }
        .status-subtitle, .status-subverifnumber { font-size: 14px; color: #64748b; margin: 0; }
        .confidence-badge { background: white; border-radius: 12px; padding: 12px 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .confidence-label { font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }
        .confidence-value { font-size: 24px; font-weight: 700; color: #dc2626; }
        .confidence-value.success { color: #16a34a; }

        /* Confidence Level Bar */
        .confidence-section { margin-bottom: 24px; }
        .confidence-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .confidence-percent { font-size: 16px; font-weight: 600; color: #1e293b; }
        .confidence-bar { width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; position: relative; }
        .confidence-fill { height: 100%; background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%); border-radius: 4px; width: 0%; transition: width 1.5s ease-out; }
        .confidence-fill.success { background: linear-gradient(90deg, #16a34a 0%, #22c55e 100%); }

        /* Extracted Information */
        .extracted-section { background: #f8fafc; border-radius: 12px; padding: 20px; }
        .extracted-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .extracted-title { font-size: 16px; font-weight: 600; color: #1e293b; }
        .info-grid { display: flex; flex-direction: column; gap: 16px; }
        .info-item { background: white; border-radius: 10px; padding: 16px; display: flex; align-items: center; gap: 14px; border: 1px solid #e2e8f0; transition: all 0.2s ease; }
        .info-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.06); transform: translateY(-2px); }
        .info-icon { width: 44px; height: 44px; background: #f1f5f9; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .info-content { flex: 1; }
        .info-label { font-size: 12px; color: #64748b; margin-bottom: 4px; font-weight: 500; }
        .info-value { font-size: 15px; color: #1e293b; font-weight: 600; }
        .info-status { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .info-status.success { background: #dcfce7; color: #16a34a; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading { animation: spin 1s linear infinite; display: inline-block; }

        @media (max-width: 1024px) {
            .container { grid-template-columns: 1fr; }
            header { padding: 1rem 1.5rem; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="logo-container">
            <div class="logo-icon">
                <div class="logo-shield"></div>
            </div>
            <div class="logo-text">
                <h1>Risk<span>Guard</span></h1>
                <p>Fraud Detection</p>
            </div>
        </div>
        <div class="header-actions">
            <button class="icon-btn" aria-label="Notifications">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span class="notification-badge"></span>
            </button>
            <button class="icon-btn" aria-label="User profile">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </button>
        </div>
    </header>

    <div class="container">
        <!-- Left Column -->
        <div>
            <!-- Section 1: Document Type -->
            <div class="section">
                <h2 class="section-title">1. S√©lectionner le type de document</h2>
                <div style="position: relative;">
                    <div class="document-type" id="docTypeSelector">
                        <div style="display: flex; align-items: center;">
                            <div class="doc-icon">üí≥</div>
                            <div class="doc-type-text">
                                <span class="doc-label">TYPE DE DOCUMENT</span>
                                <span class="doc-name" id="selectedDocType">Carte Nationale d'Identit√©</span>
                            </div>
                        </div>
                        <span class="dropdown-arrow">‚ñº</span>
                    </div>
                    <div id="docTypeMenu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e0e0e0; border-radius: 8px; margin-top: 5px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div class="doc-option" data-value="Carte Nationale d'Identit√©">Carte Nationale d'Identit√©</div>
                        <div class="doc-option" data-value="Passeport">Passeport</div>
                        <div class="doc-option" data-value="Permis de Conduire">Permis de Conduire</div>
                        <div class="doc-option" data-value="Carte de S√©jour">Carte de S√©jour</div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Upload -->
            <div class="section" style="margin-top: 20px;">
                <h2 class="section-title">2. T√©l√©verser le document</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üì§</div>
                    <div class="upload-text">Glissez-d√©posez votre document</div>
                    <div>ou <a href="#" class="upload-link" id="browseLink">parcourez vos fichiers</a></div>
                    <input type="file" id="fileInput" class="file-input" accept=".jpg,.jpeg,.png,.pdf">
                </div>
                <div class="file-preview" id="filePreview">
                    <div class="doc-icon" style="background: #e67e22; color: white;">üìÑ</div>
                    <div style="flex: 1;">
                        <div id="fileName" style="font-size: 14px; font-weight: 500;"></div>
                        <div id="fileSize" style="font-size: 12px; color: #999;"></div>
                    </div>
                    <button id="removeFile" style="background: none; border: none; color: #999; cursor: pointer; font-size: 18px;">‚úï</button>
                </div>
                <button class="analyze-btn" id="analyzeBtn" disabled>
                    <span id="btnIcon">üîç</span>
                    <span id="btnText">Analyser le document</span>
                </button>
            </div>
        </div>

        <!-- Right Column -->
        <div class="section">
            <h2 class="section-title">3. R√©sultat de la v√©rification</h2>
            <div class="result-placeholder" id="resultPlaceholder">
                <div class="upload-icon">üîç</div>
                <div style="color: #999;">L'analyse appara√Ætra ici apr√®s le t√©l√©versement.</div>
            </div>

            <div class="result-content" id="resultContent">
                <!-- Status Card -->
                <div class="status-card" id="statusCard">
                    <div class="status-header">
                        <div class="status-icon" id="statusIcon">‚úì</div>
                        <div class="status-info">
                            <h3 class="status-title" id="statusTitle">Document Authentique</h3>
                            <p class="status-subtitle" id="statusSubtitle">Aucune anomalie d√©tect√©e</p>
                            <p class="status-subverifnumber" id="statusVerifNumber">3 verifications R√©alis√©es</p>
                        </div>
                    </div>
                    <div class="confidence-badge" id="confidenceBadge">
                        <span class="confidence-label">confiance</span>
                        <span class="confidence-value" id="confidenceValue">95%</span>
                    </div>
                </div>

                <!-- Confidence Level -->
                <div class="confidence-section">
                    <div class="confidence-header">
                        <span style="font-weight: 500; color: #64748b;">Niveau de confiance</span>
                        <span class="confidence-percent" id="confidencePercent">95%</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidenceFill"></div>
                    </div>
                </div>

                <!-- Extracted Information -->
                <div class="extracted-section">
                    <div class="extracted-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <span class="extracted-title">Informations extraites</span>
                    </div>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <div class="info-content">
                                <div class="info-label">Nom </div>
                                <div class="info-value" id="infoName">-</div>
                            </div>
                            <div class="info-status success">‚úì</div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <div class="info-content">
                                <div class="info-label">Prenoms </div>
                                <div class="info-value" id="infoSurname">-</div>
                            </div>
                            <div class="info-status success">‚úì</div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="info-content">
                                <div class="info-label">Date de naissance</div>
                                <div class="info-value" id="infoBirth">-</div>
                            </div>
                            <div class="info-status success">‚úì</div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                            </div>
                            <div class="info-content">
                                <div class="info-label">Num√©ro de document</div>
                                <div class="info-value" id="infoNumber">-</div>
                            </div>
                            <div class="info-status success">‚úì</div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                            <div class="info-content">
                                <div class="info-label">Date d'expiration</div>
                                <div class="info-value" id="infoExpiry">-</div>
                            </div>
                            <div class="info-status success">‚úì</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const selectedDocType = document.getElementById('selectedDocType');
        let selectedFile = null;

        // Document Type Dropdown
        document.getElementById('docTypeSelector').addEventListener('click', () => {
            const menu = document.getElementById('docTypeMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        });

        document.querySelectorAll('.doc-option').forEach(opt => {
            opt.addEventListener('click', (e) => {
                selectedDocType.textContent = e.target.textContent;
                document.getElementById('docTypeMenu').style.display = 'none';
            });
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#docTypeSelector') && !e.target.closest('#docTypeMenu')) {
                document.getElementById('docTypeMenu').style.display = 'none';
            }
        });

        // File Upload Handlers
        document.getElementById('browseLink').addEventListener('click', (e) => { 
            e.preventDefault(); 
            fileInput.click(); 
        });

        document.getElementById('uploadArea').addEventListener('click', (e) => { 
            if(e.target.id !== 'browseLink') fileInput.click(); 
        });

        // Drag and Drop
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if(e.dataTransfer.files.length > 0) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if(e.target.files.length > 0) handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            selectedFile = file;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = (file.size / 1024).toFixed(1) + ' KB';
            document.getElementById('filePreview').classList.add('show');
            analyzeBtn.disabled = false;
        }

        document.getElementById('removeFile').addEventListener('click', (e) => {
            e.stopPropagation();
            selectedFile = null;
            fileInput.value = '';
            document.getElementById('filePreview').classList.remove('show');
            analyzeBtn.disabled = true;
            document.getElementById('resultContent').classList.remove('show');
            document.getElementById('resultPlaceholder').style.display = 'block';
        });

        // Analyze Button
        analyzeBtn.addEventListener('click', async () => {
            if (!selectedFile) return;

            analyzeBtn.disabled = true;
            document.getElementById('btnIcon').innerHTML = '‚è≥';
            document.getElementById('btnIcon').classList.add('loading');
            document.getElementById('btnText').textContent = 'Analyse en cours...';

            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('type_document', selectedDocType.textContent);

            try {
                const response = await fetch('/ai-api/ocr_document', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error('Erreur API');
                
                const data = await response.json();
                updateUI(data.model_response);
            } catch (error) {
                alert("Erreur lors de l'analyse. Veuillez r√©essayer.");
                console.error(error);
            } finally {
                analyzeBtn.disabled = false;
                document.getElementById('btnIcon').innerHTML = 'üîç';
                document.getElementById('btnIcon').classList.remove('loading');
                document.getElementById('btnText').textContent = 'Analyser le document';
            }
        });

        // Update UI with Results
        function updateUI(res) {
            document.getElementById('resultPlaceholder').style.display = 'none';
            document.getElementById('resultContent').classList.add('show');

            const score = res.score || 0;
            const var_seuil =  70
            const isSuccess = score >= var_seuil;

            // Status Card
            const statusCard = document.getElementById('statusCard');
            const statusIcon = document.getElementById('statusIcon');
            const statusTitle = document.getElementById('statusTitle');
            const statusSubtitle = document.getElementById('statusSubtitle');
            const confidenceValue = document.getElementById('confidenceValue');
            
            if (isSuccess) {
                statusCard.classList.add('success');
                statusIcon.classList.add('success');
                statusIcon.textContent = '‚úì';
                statusTitle.textContent = 'Document Authentique';
                statusSubtitle.textContent = 'Aucune anomalie apparente d√©tect√©e';
                confidenceValue.classList.add('success');
            } else {
                statusCard.classList.remove('success');
                statusIcon.classList.remove('success');
                statusIcon.textContent = '‚úï';
                statusTitle.textContent = 'Document Non Conforme';
                statusSubtitle.textContent = 'Des anomalies ont √©t√© d√©tect√©es sur ce document';
                confidenceValue.classList.remove('success');
            }

            // Animate Confidence Badge
            animateValue("confidenceValue", 0, score, 1500, '%');

            // Confidence Bar
            const confidenceFill = document.getElementById('confidenceFill');
            const confidencePercent = document.getElementById('confidencePercent');
            
            if (isSuccess) {
                confidenceFill.classList.add('success');
            } else {
                confidenceFill.classList.remove('success');
            }
            
            setTimeout(() => {
                confidenceFill.style.width = score + '%';
            }, 100);
            
            animateValue("confidencePercent", 0, score, 1500, '%');

            // Extracted Information
            document.getElementById('infoName').textContent = res.extracted_data?.name || res.info.nom || 'Non d√©tect√©';
            document.getElementById('infoSurname').textContent = res.extracted_data?.name || res.info.prenoms || 'Non d√©tect√©';
            document.getElementById('infoBirth').textContent = res.extracted_data?.birth_date || res.info.date_naissance || 'Non d√©tect√©';
            document.getElementById('infoNumber').textContent = res.extracted_data?.document_number || res.info.numero_doc || 'Non d√©tect√©';
            document.getElementById('infoExpiry').textContent = res.extracted_data?.expiry_date || res.info.date_expiration || 'Non d√©tect√©';
        }

        // Animate Number Values
        function animateValue(id, start, end, duration, suffix = '') {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.textContent = Math.floor(progress * (end - start) + start) + suffix;
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }
    </script>
</body>
</html>